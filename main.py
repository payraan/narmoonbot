import os
import logging
import random
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes, ConversationHandler
import pytz
from datetime import datetime

# ุชูุธู ูุงฺฏูฺฏ
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO
)
logger = logging.getLogger(__name__)

# ูุถุนุชโูุง ูุฎุชูู ูฺฉุงููู
CHOOSING_PLAN, PAYMENT_CONFIRMATION = range(2)

# ูุณุช ุขุฏุฑุณโูุง ฺฉู ูพูู ุณููุงูุง ุจุฑุง ุงุฑุงุฆู ุชุตุงุฏู
TETHER_WALLET_ADDRESSES = [
    "7VC1edh1KhXatqQLJPKGuX93xd1gi6WznPGy6qXxpcrA",
    "Hw3WZ6XMSiuAr6XipAEBfEgkbN1TqRCJ22aJozg9svdQ",
    "8eS47TxaXUE3PCA5gr6W1c9qYLJXENQGSC7wduEfvdKQ",
    "BDFtuUtub1NAsAEnQvzQZxiicxosSUVsUsKsHsnPxExZ",
    "ESNDemhHSwfZnzbeWrKUUijbv3BWR5zTwrzRbfy3mp9F",
    "4oAUPf44KvouqT3qFGRV2JQEjvefE9XrpxDUGSEoKtQd",
    "ECZNWmQRC7oNULsKesJtZnsGdxCQfuztduEkL3HdVB1m",
    "G2A1RgjtyVSjRVT9ob7rSACi4GpKqtpTUedi66uFW6i1",
    "EeGFTsyECycRp1TjvTH8FXKdoSbnhjXyaRprM8KEZwVZ",
    "6hnU6ehPtC9whL12jv6Z7rFvw4iQLSiNg5r4cBH3womz"
]

# ุดุจฺฉู ุชุชุฑ
TETHER_NETWORK = "Solana"

# ุขุฏุฑุณ ูพุดุชุจุงู ฺฉู TXID ุจุฑุง ุขู ุงุฑุณุงู ูโุดูุฏ
SUPPORT_LINK = "https://t.me/Sultan_immortal"

# ููุชโูุง ูุญุตูู
NARMOON_DEX_PRICE = "ต ุฏูุงุฑ ูุงูุงูู (ุจุง ุชุฎูู ตฐูช)"
NARMOON_COIN_PRICE = "ต ุฏูุงุฑ ูุงูุงูู (ุจุง ุชุฎูู ตฐูช)"
NARMOON_COMBO_PRICE = "ฑฐ ุฏูุงุฑ ูุงูุงูู (ุจุง ุชุฎูู ูฺู)"

# ุชุงุจุน ุจุฑุง ุงูุชุฎุงุจ ุชุตุงุฏู ุขุฏุฑุณ ฺฉู ูพูู
def get_random_wallet_address():
    return random.choice(TETHER_WALLET_ADDRESSES)

# ุชุงุจุน ุดุฑูุน ุฑุจุงุช
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    
    # ูุนุฑู ูุญุตูู ุจุง ูุฑูุช ุฌุฏุฏ
    intro_message = (
        f"ุณูุงู {user.first_name}! ๐โจ\n\n"
        f"**ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ูุงุฑูููู** ๐\n\n"
        f"๐ ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ฺฉู ูุนุงููู ฺฏุฑ ุฏุฑ ุจุงุฒุงุฑ ุฑูุฒุงุฑุฒูุง ุฑู ุจุฑุงุช ุณุงุฏูโุชุฑุ ุณุฑุนโุชุฑ ู ููุดููุฏุชุฑ ูโฺฉูู.\n\n"
        f"๐ง ูุงุฑูููู ฺฉ ุณุณุชู ููุด ูุตููุน ุดุฎุตโุณุงุฒโุดุฏู ุจุฑ ูพุงู GPT-4o ูุณุช ฺฉู ุชูุงู ุงุจุฒุงุฑูุง ุญุฑููโุง ุชุญูู ุชฺฉูฺฉุงูุ ุขูฺู ู ุณฺฏูุงูโุฏู ูุญุธูโุง ุฑู ุฏุฑ ุฎูุฏุด ุฌูุน ฺฉุฑุฏูุ ูุฎุตูุตุงู ุจุฑุง ุชุฑุฏุฑูุง ฺฉู ุฏุฑ ูุถุง DEXุ CEXุ ููโฺฉููโูุง ุง ุขูุชฺฉููโูุง ุชุฑูุฏ ูุนุงูุช ูโฺฉูู.\n\n"
        f"๐ ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ูุงุฑูููู ฺฉ ูุดุงูุฑ ูุชุฎุตุต ูุณุชุด ฺฉู ฒด ุณุงุนุช ุฑูุฒ ู ท ุฑูุฒ ููุชู ุฏุฑ ฺฉูุงุฑุชู"
    )
    
    # ููู ุงุตู ุจุฏูู ฺฏุฒูู ูุจุณุงุช
    keyboard = [
        [InlineKeyboardButton("โ ูุงุจูุชโูุง ุฏุณุชุงุฑ ููุด ูุตููุน ูุงุฑูููู", callback_data="product_features")],
        [InlineKeyboardButton("๐ฆ ูุญุตููุงุช ูุงุฑูููู", callback_data="product_list")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("โ ุณูุงูุงุช ูุชุฏุงูู", callback_data="faq")],
        [InlineKeyboardButton("๐ ุดุฑุงุท ู ุถูุงุจุท", callback_data="terms_conditions")],
        [InlineKeyboardButton("๐จโ๐ป ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู", url=SUPPORT_LINK)]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(intro_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ูุงุจูุชโูุง ูุญุตูู
async def show_product_features(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    features_message = (
        "**ูุงุจูุช ูุง ุฏุณุชุงุฑ ููุด ูุตููุน ูุงุฑูููู:** ๐\n\n"
        "**๐ ูุธุงุฑุช ูุญุธูโุง ู ุดฺฉุงุฑ ุณุฑุน ูุฑุตุชโูุง**\n"
        "ูุงุฑูููู ุดุจุงููโุฑูุฒ ุจุงุฒุงุฑ ุฑู ุฑุตุฏ ูโฺฉูู ู ุจุง ุงุณุชูุงุฏู ุงุฒ ุงูฺฏูุฑุชูโูุง ูุนุงููุงุชุ ุฏููโุชุฑู ูุญุธุงุช ูุฑูุฏ ู ุฎุฑูุฌ ุฑู ุจุฑุง ุชู ุดูุงุณุง ูโฺฉูู.\n\n"
        "**๐ ุชุญูู ุชฺฉูฺฉุงู + ุขูฺู + ุฏุชุง ูุญูุฑ**\n"
        "ุชุญูู ุชฺฉูฺฉุงู ุจุง ุจุด ุงุฒ ตฐ ุงุณุชุฑุงุชฺ ฺฉูุงุณฺฉ ู ูพุดุฑูุชูุ ุจุฑุฑุณ ุฑูุชุงุฑ ูููฺฏโูุงุ ูููุฏุฑูุง ู smart money ู ุชุดุฎุต ุฑููุฏ ุจุงุฒุงุฑ ุงุฒ ุทุฑู ุฎุทูุท ุฑููุฏุ ูุงฺฏุฑุงโูุงุ ูุจููุงฺ ู...\n\n"
        "**๐ฏ ุณฺฏูุงู ุฏููุ ุดูุงู ู ุดุฎุตโุณุงุฒโุดุฏู**\n"
        "ุณฺฏูุงูโูุง ฺฉู ููุท ุจุฑ ุงุณุงุณ ุฏุงุฏูโูุง ูุงูุนุ ููุงุญ ุญูุงุช ูุนุชุจุฑ ู ุชุญูู ฺูุฏุฌุงูุจู ุตุงุฏุฑ ูโุดู โ ุจุฏูู ููุช ูุญุธูโุง ู ุญุฏุณ ู ฺฏูุงู.\n\n"
        "**๐ญ ูพุฏุง ฺฉุฑุฏู ุชูฺฉูโูุง ู ฺฉููโูุง ุชุฑูุฏ**\n"
        "ุงุฒ ุชูฺฉูโูุง ูพุงููพ ูุดุฏู ุณููุงูุง ฺฏุฑูุชู ุชุง ุขูุชฺฉููโูุง ุชุฑูุฏ ุฏุฑ CoinMarketCap โ ูุงุฑูููู ุจูโุตูุฑุช ูุญุธูโุง ูุณุช ูโุณุงุฒู ู ุงููโูุง ุฑู ุจุฑุงุช ุชุญูู ูโฺฉูู.\n\n"
        "**๐ ุจุฑุฑุณ ุงููุช ู ุณุงุจูู ุชูฺฉู**\n"
        "ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุงุฏูโูุง ุขูฺูุ ุงุณูุงุฑุช ฺฉุงูุชุฑฺฉุชุ ุญุฌู ููุฏูฺฏ ู ุณู ูพุฑูฺูุ ุชูฺฉูโูุง ุงุณฺฉู ุง ุฑุงฺฏโูพูู ุฑู ููุชุฑ ูโฺฉูู.\n\n"
        "**๐ ุจุฑุฑุณ ููุชโูุง ูููฺฏโูุง ู ุฐุฎุงุฑ ุนููู**\n"
        "ุงุฒ ุชุญูู ูููุฏุฑูุง ุจุชฺฉูู ู ุงุชุฑูู ฺฏุฑูุชู ุชุง ุจุฑุฑุณ ฺฉูโูพูู ุดุฑฺฉุชโูุง ุจุฒุฑฺฏ (ูุซู MicroStrategy ุง Tesla) ููู ู ููู ุฏุฑ ฺฉ ูฺฏุงู."
    )
    
    keyboard = [
        [InlineKeyboardButton("๐ฆ ูุดุงูุฏู ูุญุตููุงุช", callback_data="product_list")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(features_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ูุณุช ูุญุตููุงุช (ุจุฏูู ููุช)
async def show_product_list(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    products_message = (
        "**๐ฆ ูุญุตููุงุช ูุงุฑูููู:**\n\n"
        "**๐ ูุงุฑูููู ุฏฺฉุณ**\n"
        "ููุด ูุตููุน ุดุฎุต ุณุงุฒ ุดุฏู ุจุฑ ูพุงู GPT-4o ุจุฑุง ุจุงุฒุงุฑูุง ุบุฑูุชูุฑฺฉุฒ (DEX)\n"
        "โข ุดฺฉุงุฑ ุชูฺฉู ูุง ูพุฑูพุชุงูุณู ุจุงุฒุงุฑ ุจุตูุฑุช ูุญุธู ุง\n"
        "โข ุงุณุชุฎุฑุงุฌ ุงุทูุงุนุงุช ฺฉุงูู ุชูฺฉู\n"
        "โข ุชุญูู ุฑูุชุงุฑ ูููุฏุฑ ูุง\n"
        "โข ูพุฏุง ฺฉุฑุฏู ุชุฑูุฏ ูุง ุฑูุฒ\n"
        "โข ุดูุงุณุง ูุฑูุฏ ู ุฎุฑูุฌ ูพูู ููุดููุฏ ุจู ูุฑ ุชูฺฉู\n"
        "โข ุชุญูู ุชฺฉูฺฉุงู ุจุฑ ุงุณุงุณ ุจุด ุงุฒ ตฐ ุงุณุชุฑุงุชฺ ุจุฑุชุฑ\n"
        "โข ุจุฑุฑุณ ฺฉู ูพูู ูุง ูููฺฏ ูุง\n"
        "โข ุจุฑุฑุณ ุงููุช ุชูฺฉู\n"
        "โข ุงุฑุงุฆู ุณฺฏูุงู ุฏูู\n"
        "โข ุฏุณุชุงุฑ ุชุฎุตุต ุดูุง ุงุฒ ุดุฑูุน ุชุง ูพุงุงู ูุนุงููู ูุญุธู ุจู ูุญุธู\n\n"
        
        "**๐ ูุงุฑูููู ฺฉูู**\n"
        "ููุด ูุตููุน ุดุฎุต ุณุงุฒ ุดุฏู ุจุฑ ูพุงู GPT-4o ุจุฑุง ุจุงุฒุงุฑูุง ูุชูุฑฺฉุฒ (CEX)\n"
        "โข ูพุฏุง ฺฉุฑุฏู ุชุฑูุฏ ูุง ุฑูุฒ ุขูุชฺฉูู ูุง\n"
        "โข ุงุฑุงุฆู ุงุทูุงุนุงุช ฺฉุงูู ุฑูุฒุงุฑุฒูุง\n"
        "โข ุจุฑุฑุณ ุงูุชุตุงุฏ ู ุชูุฑู ุฑูุฒุงุฑุฒูุง\n"
        "โข ููุงุณู ุฑูุฒุงุฑุฒูุง ูุฎุชูู\n"
        "โข ุชุญูู ุชฺฉูฺฉุงู ุจุฑ ุงุณุงุณ ุจุด ุงุฒ ตฐ ุงุณุชุฑุงุชฺ ุจุฑุชุฑ\n"
        "โข ุชุญูู ุขูฺู ุจุชฺฉูู ู ุงุชุฑูู\n"
        "โข ุงุฑุงุฆู ฺฏุฒุงุฑุด ูุญุธู ุง ุงุฒ ุฏุงุฑุง ูุง ุจุฒฺฏุชุฑู ุฏุงุฑูุฏฺฏุงู ุจุชฺฉูู ุฏุฑ ุฌูุงู\n"
        "โข ุณฺฏูุงู ุฏูู ุฑูุฒุงุฑุฒูุง\n"
        "โข ุฏุงุฏูโูุง ุฌูุงู ุฑูุฒุงุฑุฒูุง ู DeFi\n"
        "โข ุงุฑุงุฆู ูููุชุฑู ุงุฎุจุงุฑ ูุญุธู ุง ุจู ููุฑุงู ุชุญูู ุฌุงูุน\n\n"
        
        "**๐ ูพฺฉุฌ ุชุฑฺฉุจ ูุงุฑูููู ุฏฺฉุณ + ูุงุฑูููู ฺฉูู**\n"
        "ุฏุณุชุฑุณ ุจู ุชูุงู ูุงุจูุชโูุง ูุฑ ุฏู ูุญุตูู ุจุง ฺฉ ุงุดุชุฑุงฺฉ ูฺู"
    )
    
    keyboard = [
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("โ ุณูุงูุงุช ูุชุฏุงูู", callback_data="faq")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(products_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ุณูุงูุงุช ูุชุฏุงูู ุจุง ุดูุงุฑู ู ุงููุฌ
async def show_faq(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    faq_message = (
        "**โ ุณูุงูุงุช ูุชุฏุงูู**\n"
        "ูพุงุณุฎ ุจู ุณูุงูุงุช ุฑุงุฌ ุฏุฑุจุงุฑู ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ูุงุฑูููู\n\n"
        
        "**1๏ธโฃ ูุงุฑูููู ุฏููุงู ฺู ู ฺู ฺฉุงุฑ ุจุฑุงู ุงูุฌุงู ูโุฏูุ** ๐ค\n"
        "ูุงุฑูููู ฺฉ ุฏุณุชุงุฑ ููุด ูุตููุน ุชุญููโฺฏุฑ ุจุฑ ูพุงู GPT-4o ูุณุช ฺฉู ุจุงุฒุงุฑ ุฑูุฒุงุฑุฒ ุฑู ุจูโุตูุฑุช ูุญุธูโุง ุฑุตุฏ ูโฺฉููุ ุชูฺฉูโูุง ุชุฑูุฏ ุฑู ูพุฏุง ูโฺฉููุ ุณฺฏูุงู ุฎุฑุฏ/ูุฑูุด ูโุฏู ู ููู ฺุฒ ุงุฒ ุชุญูู ุชฺฉูฺฉุงูุ ุขูฺู ุชุง ุจุฑุฑุณ ุงููุช ู ุงุฎุจุงุฑ ุฑู ุชู ฺฉ ุงุจุฒุงุฑ ุจุฑุงุช ุฌูุน ูโฺฉูู.\n\n"
        
        "**2๏ธโฃ ุขุง ูุงุฑูููู ุงูฺฉุงู ุฎุฑุฏ ุง ูุฑูุด ูุณุชูู ุฑูุฒุงุฑุฒ ุฏุงุฑูุ** ๐ฑ\n"
        "ุฎุฑ. ูุงุฑูููู ุตุฑูุงู ฺฉ ุงุจุฒุงุฑ **ุชุญูู ู ุณฺฏูุงูโุฏู** ููุดููุฏู. ุฎุฑุฏ ุง ูุฑูุด ุฑูุฒุงุฑุฒ ุจุงุฏ ุงุฒ ุทุฑู ุตุฑุงูโูุง ฺฉู ุจุงูุงุดูู ฺฉุงุฑ ูโฺฉูุฏ ุงูุฌุงู ุจุดู.\n\n"
        
        "**3๏ธโฃ ฺุทูุฑ ูุทูุฆู ุจุงุดู ฺฉู ุชูฺฉูโูุง ุงุณฺฉู ุง ุฑุงฺฏ ูุณุชูุ** ๐\n"
        "ูุงุฑูููู ุจุง ุจุฑุฑุณ **ุณู ูพุฑูฺูุ ุชุนุฏุงุฏ ูููุฏุฑูุงุ ุญุฌู ูุนุงููุงุชุ ููุฏูฺฏุ ุงุณูุงุฑุช ฺฉุงูุชุฑฺฉุช ู ุชุญูู ฺุงุฑุช ุฑุงฺฏโูพูู** ุงุญุชูุงู ุงุณฺฉู ุจูุฏู ุชูฺฉูโูุง ุฑู ฺฉุงูุด ูโุฏู ู ุญุช ูุดุฏุงุฑูุง ุงููุช ูุดูู ูโุฏู.\n\n"
    )
    
    # ฺูู ูุชู ุทููุงู ุงุณุชุ ุขู ุฑุง ุจู ุฏู ุจุฎุด ุชูุณู ูโฺฉูู
    faq_message_part2 = (
        "**โ ุณูุงูุงุช ูุชุฏุงูู (ุงุฏุงูู)**\n\n"
        
        "**4๏ธโฃ ุณฺฏูุงูโูุง ฺฉู ูุงุฑูููู ูโุฏู ูุงุจู ุงุทููุงู ูุณุชูุ** ๐\n"
        "ุณฺฏูุงูโูุง ุจุฑ ุงุณุงุณ ุงูฺฏูุฑุชูโูุง ุชุญูู ุชฺฉูฺฉุงูุ ููุงุญ ุญูุงุช ูุงฺูุฑ ู ุขูฺู ุตุงุฏุฑ ูโุดูุ ุงูุง ุชุตูู ููุง ุจุฑุง ูุนุงููู ุจุง ฺฉุงุฑุจุฑู ู ูุงุฑูููู ูฺโฺฏููู ูุณุฆููุช ูุงู ูุฏุงุฑู.\n\n"
        
        "**5๏ธโฃ ุขุง ุจุฑุง ุงุณุชูุงุฏู ุจุงุฏ ุงุทูุงุนุงุช ุญุณุงุจ ุตุฑุงู ุฑู ูุงุฑุฏ ฺฉููุ** ๐\n"
        "ูู! ูุงุฑูููู **ูฺ ุงุทูุงุนุงุช ูุซู APIุ ูุฒุฑูู ุง ุฑูุฒ ุนุจูุฑ ุตุฑุงู** ุงุฒุช ููโุฎูุงุฏ. ุงุทูุงุนุงุชุช ููุดู ูุญุฑูุงูู ู ุงูู ุจุงู ูโูููู.\n\n"
        
        "**6๏ธโฃ ุชูุงูุช ุจู ูุงุฑูููู DEX ู ูุงุฑูููู COIN ฺูุ** ๐\n"
        "**Narmoon DEX**: ูุฎุตูุต ุชุญูู ุชูฺฉูโูุง DEX (ูุซู ุณููุงูุงุ ููโฺฉููโูุง)\n**Narmoon COIN**: ูุฎุตูุต ุชุญูู ฺฉููโูุง ุจุฒุฑฺฏ ุฏุฑ ุตุฑุงูโูุง ูุชูุฑฺฉุฒ (BTC, ETH, SOL ู ุขูุชฺฉููโูุง)\n\n"
        
        "**7๏ธโฃ ุขุง ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ูุงุฑูููู ุจุงุฏ ุงุดุชุฑุงฺฉ ChatGPT ุฏุงุดุชู ุจุงุดูุ** ๐ค\n"
        "ุจูู. ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชุงุฑ ููุด ูุตููุน **ูุงุฑูููู**ุ ุจุงุฏ ุญุณุงุจ ูุนุงู ุฏุฑ **ChatGPT** ุฏุงุดุชู ุจุงุดุฏ. ููฺูู ุจุฑุง ุฏุณุชุฑุณ ฺฉุงููุ ุจุฏูู ูุญุฏูุฏุช ู ุงุฌุฑุง ููู ูุงุจูุชโูุง ุญุฑููโุง (ูุซู ูพุงุณุฎโูุง ุทููุงูุ ุฏุณุชุฑุณ ุจู GPT-4o ู APIูุง)ุ ูุงุฒู ุงุณุช ฺฉู **ูพูู Plus ุง Pro** (ุงุดุชุฑุงฺฉ ูพูู ChatGPT) ุฑุง ุฎุฑุฏุงุฑ ฺฉุฑุฏู ุจุงุดุฏ."
    )
    
    keyboard = [
        [InlineKeyboardButton("โฉ ุงุฏุงูู ุณูุงูุงุช ูุชุฏุงูู", callback_data="faq_part2")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(faq_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ุจุฎุด ุฏูู ุณูุงูุงุช ูุชุฏุงูู
async def show_faq_part2(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    faq_message_part2 = (
        "**โ ุณูุงูุงุช ูุชุฏุงูู (ุงุฏุงูู)**\n\n"
        
        "**8๏ธโฃ ุขุง ูุงุฑูููู ุงุฎุจุงุฑ ุจุงุฒุงุฑ ุฑูุฒุงุฑุฒ ุฑู ูู ูพูุดุด ูโุฏูุ** ๐ฐ\n"
        "ุจูู. ูุงุฑูููู ุจุง ุงุณุชูุงุฏู ุงุฒ ููุงุจุน ูุนุชุจุฑ ุฌูุงูุ **ุงุฎุจุงุฑ ูุญุธูโุง ุฑู ููุฑุงู ุจุง ุชุญูู ุงุซุฑ ุงููโูุง ุฑู ุจุงุฒุงุฑ** ุจูุช ุงุฑุงุฆู ูโุฏู.\n\n"
        
        "**9๏ธโฃ ุขุง ุงูฺฉุงู ุณุงุฎุช ุงุณุชุฑุงุชฺ ุดุฎุต ุชู ูุงุฑูููู ูุฌูุฏ ุฏุงุฑูุ** ๐งฉ\n"
        "ุจูู. ุดูุง ูโุชููุฏ ุงุณุชุฑุงุชฺ ุฎูุฏุชูู ุฑู ุจุฑุงุณุงุณ ุงูุฏฺฉุงุชูุฑูุง ู ุดุฑุงุท ุฏูุฎูุงู ุจุณุงุฒุฏ ู ุจุงุฒุงุฑ ุฑู ุทุจู ุงูู ุฑุตุฏ ฺฉูุฏ.\n\n"
        
        "**๐ ูพููโูุง ูุงุฑูููู ฺุฌูุฑ ูุณุชูุ** ๐ฐ\n"
        "ูุง ฺูุฏ ูพูู ูุฎุชูู ุฏุงุฑู (ูุงูุงููุ ุณุงูุงููุ ุฌุดููุงุฑูโุง) ฺฉู ุฌุฒุฆุงุชุดูู ุฏุงุฎู ุณุงุช ูุณุช. ููุท ูพูู ุณุงูุงูู ุดุงูู **ท ุฑูุฒ ุถูุงูุช ุจุงุฒฺฏุดุช ูุฌู** ูุณุช.\n\n"
        
        "**1๏ธโฃ1๏ธโฃ ุดุฑุงุท ุงุณุชูุงุฏู ุงุฒ ฺฏุงุฑุงูุช ุจุงุฒฺฏุดุช ูุฌู ฺูุ** ๐\n"
        "ุฏุฑ ุตูุฑุช ฺฉู ูพูู ุณุงูุงูู ุฎุฑุฏุงุฑ ุดุฏู ุจุงุดูุ ุชุง ท ุฑูุฒ ูุฑุตุช ุฏุงุฑ ุฏุฑุฎูุงุณุช ุนูุฏุช ูุฌู ุซุจุช ฺฉู ู ูุจูุบ ุท ฑฐ ุฑูุฒ ฺฉุงุฑ ุจุฑฺฏุดุช ุฏุงุฏู ูโุดู.\n\n"
        
        "**1๏ธโฃ2๏ธโฃ ุขุง ูุงุฑูููู ุจูโุฑูุฒุฑุณุงู ูโุดูุ** ๐\n"
        "ุจูู. ูุงุฑูููู ุจูโุตูุฑุช ูพูุณุชู ุจุฑูุฒุฑุณุงู ูโุดู. ุงฺฏู ูุทุน ุง ุชุบุฑุงุช ููู ุจุงุดูุ ุงุฒ ุทุฑู ฺฉุงูุงู ุฑุณู ุง ุงูู ุงุทูุงุนโุฑุณุงู ูโฺฉูู.\n\n"
        
        "**1๏ธโฃ3๏ธโฃ ุงุทูุงุนุงุช ุณฺฏูุงู ุดุงูู ฺู ฺุฒูุง ูโุดูุ** ๐\n"
        "ูุฑ ุณฺฏูุงู ุดุงูู: **ูุงู ุชูฺฉูุ ูุงุญู ูุฑูุฏุ ุชุงุฑฺฏุชโูุงุ ุงุณุชุงูพุ ุฑุณฺฉ/ุฑูุงุฑุฏุ ูุถุนุช ุงููุชุ ููฺฉ ฺุงุฑุช ู ููฺฉ ุฎุฑุฏ ูุณุชูู** ูุณุช.\n\n"
        
        "**1๏ธโฃ4๏ธโฃ ุขุง ุงุณุชูุงุฏู ุงุฒ ูุงุฑูููู ูพฺุฏูโุณุชุ** ๐ฎ\n"
        "ุงุตูุงู! ุฑุงุจุท ฺฉุงุฑุจุฑ ูุงุฑูููู ุณุงุฏูุ ุชูุฒ ู ุจุฑุง ููู ูุงุจู ุงุณุชูุงุฏูโุณุช โ ุญุช ุงฺฏู ุชุงุฒู ูุงุฑุฏ ูุงุฑฺฉุช ุจุงุด.\n\n"
        
        "**1๏ธโฃ5๏ธโฃ ุขุง ุงูฺฉุงู ุฏุณุชุฑุณ ุจู ุงุทูุงุนุงุช ุขูฺู BTC ู ETH ูุณุชุ** โ๏ธ\n"
        "ุจูู. ูุงุฑูููู ฺฉูู ูโุชููู ุขูฺู ุจุชฺฉูู ู ุงุชุฑููุ ููฺูู ุฑูุชุงุฑ ูููฺฏโูุงุ ูุฑูุฏโูุง ุจู ุตุฑุงูโูุง ู ุฐุฎุงุฑ ุดุฑฺฉุชโูุง ุฑู ุชุญูู ฺฉูู.\n\n"
        
        "**1๏ธโฃ6๏ธโฃ ุขุง ุงุณุชูุงุฏู ุบุฑูุฌุงุฒ ุงุฒ ูุญุชูุง ุง ฺฉูพโุจุฑุฏุงุฑ ูุฌุงุฒูุ** ๐\n"
        "ุฎุฑ. ูุฑฺฏููู **ฺฉูพุ ุงูุชุดุงุฑุ ูุฑูุด ูุฌุฏุฏ ุง ุชุบุฑ ูุญุชูุง ุจุฏูู ูุฌูุฒ ุฑุณู** ูพฺฏุฑุฏ ูุงููู ุฏุงุฑู ู ุฎูุงู ุดุฑุงุท ุงุณุชูุงุฏู ูุญุณูุจ ูโุดู."
    )
    
    keyboard = [
        [InlineKeyboardButton("โช ุณูุงูุงุช ูุจู", callback_data="faq")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(faq_message_part2, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ุดุฑุงุท ู ุถูุงุจุท ุจุง ุงููุฌ
async def show_terms_conditions(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    terms_message = (
        "**๐ ุดุฑุงุท ู ุถูุงุจุท ุงุณุชูุงุฏู ุงุฒ ุฏุณุชุงุฑ ููุด ูุตููุน ูุนุงูููโฺฏุฑ ูุงุฑูููู**\n\n"
        "ุงุฒ ุดูุง ฺฉุงุฑุจุฑ ฺฏุฑุงู ุฏุนูุช ูโฺฉูู ูพุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ูพูุชูุฑู ุชุญููโฺฏุฑ ู ุณฺฏูุงูโุฏู ููุดููุฏ **ูุงุฑูููู**ุ ุงู ุดุฑุงุท ุฑุง ุจุง ุฏูุช ูุทุงูุนู ููุงุฏ. ุงุณุชูุงุฏู ุงุฒ ุฎุฏูุงุช ูุงุฑูููู ุจู ููุฒููโ ูพุฐุฑุด ฺฉุงูู ููุงุฑุฏ ุฒุฑ ุฎูุงูุฏ ุจูุฏ. ูุฏู ูุง ุญูุธ ุงููุช ฺฉุงุฑุจุฑุงูุ ุดูุงูุช ุฎุฏูุงุช ู ุงุฑุงุฆู ุชุฌุฑุจูโุง ุญุฑููโุง ู ูุงุจู ุงุนุชูุงุฏ ุฏุฑ ูุถุง ุชุญูู ุจุงุฒุงุฑูุง ุฑูุฒุงุฑุฒ ุงุณุช.\n\n"
        
        "**1๏ธโฃ ุงููุช ุงุทูุงุนุงุช** ๐\n"
        "ูุงุฑูููู ุจู ูฺโูุฌู ุงุทูุงุนุงุช ุญุณุงุจ ฺฉุงุฑุจุฑ ุดูุง ุฏุฑ ุตุฑุงูโูุง (ุงุฒ ุฌููู APIุ ูุฒุฑููุ ูพุณูุฑุฏุ ฺฉูุฏ ุฎุตูุต ู...) ุฑุง ุฏุฑุฎูุงุณุช ููโฺฉูุฏ. ูุทูุงู ูฺโฺฏููู ุงุทูุงุนุงุช ุญุณุงุณ ุฑุง ุฏุฑ ุงุฎุชุงุฑ ูฺ ูุฑุฏ ุง ูพูุชูุฑู ูุฑุงุฑ ูุฏูุฏุ ุญุช ุงฺฏุฑ ุฎูุฏ ุฑุง ููุงูุฏู ูุงุฑูููู ูุนุฑู ฺฉูุฏ.\n\n"
        
        "**2๏ธโฃ ูุงูุช ูพูุชูุฑู** ๐ง\n"
        "ูุงุฑูููู ฺฉ **ุฏุณุชุงุฑ ููุดููุฏ ุชุญููโฺฏุฑ** ุงุณุชุ ูู ุตุฑุงู ุง ุจุณุชุฑ ุงูุฌุงู ูุนุงููุงุช. ูฺ ุฎุฑุฏ ุง ูุฑูุด ูุณุชูู ุฑูุฒุงุฑุฒ ุฏุฑ ุงู ูพูุชูุฑู ุงูุฌุงู ููโุดูุฏ.\n\n"
        
        "**3๏ธโฃ ุนุฏู ุงุฑุงุฆู ูุดุงูุฑู ูุงู** ๐ผ\n"
        "ุงฺฏุฑฺู ูุงุฑูููู ุจุง ุงุณุชูุงุฏู ุงุฒ ููุด ูุตููุน ูพุดุฑูุชูุ ุณฺฏูุงูโูุง ู ุชุญููโูุง ุฏูู ุงุฑุงุฆู ูโุฏูุฏุ ุงูุง ุงู ุฏุงุฏูโูุง **ูุดุงูุฑู ุณุฑูุงูโฺฏุฐุงุฑ ุดุฎุต ุง ุชุถูู ุณูุฏ** ูุณุชูุฏ. ูุฑ ฺฉุงุฑุจุฑ ูพุด ุงุฒ ุงูุฏุงู ุจู ุฎุฑุฏ ุง ูุฑูุดุ ููุธู ุงุณุช ุจุง ุจุฑุฑุณ ุดุฎุต ุฎูุฏ ุชุตููโฺฏุฑ ฺฉูุฏ."
    )
    
    keyboard = [
        [InlineKeyboardButton("โฉ ุงุฏุงูู ุดุฑุงุท ู ุถูุงุจุท", callback_data="terms_part2")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(terms_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ุจุฎุด ุฏูู ุดุฑุงุท ู ุถูุงุจุท
async def show_terms_part2(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    terms_message_part2 = (
        "**๐ ุดุฑุงุท ู ุถูุงุจุท (ุงุฏุงูู)**\n\n"
        
        "**4๏ธโฃ ูุณุฆููุช ุฑุณฺฉ ูุนุงููุงุช** โ๏ธ\n"
        "ฺฉูู ุณฺฏูุงูโูุง ู ุชุญููโูุง ุฏุฑ ูุงุฑูููู ูุจุชู ุจุฑ ุงูฺฏูุฑุชูโูุง ุฏุงุฏูโูุญูุฑ ู ูพุฑุฏุงุฒุด ููุดููุฏ ูุณุชูุฏุ ุงูุง ูุชุฌู ููุง ูุนุงููุงุช ุจู ุนูุฏู ฺฉุงุฑุจุฑ ุงุณุช. **ูพุฐุฑุด ุฑุณฺฉ ุณุฑูุงูโฺฏุฐุงุฑุ ุจุฑ ุนูุฏู ุงุณุชูุงุฏูโฺฉููุฏู ุงุฒ ุณฺฏูุงู ุงุณุช.**\n\n"
        
        "**5๏ธโฃ ุจุฑูุฒุฑุณุงู ู ุจูุจูุฏ ุณุงูุงูู** ๐\n"
        "ูุงุฑูููู ููฺฉู ุงุณุช ุจูโุตูุฑุช ุฏูุฑูโุง ุง ูุงููุธู ุจุฑูุฒุฑุณุงู ุดูุฏ. ุฏุฑ ุตูุฑุช ุชุบุฑุงุช ููู ุง ูุทุน ูููุชุ ุงุทูุงุนโุฑุณุงู ุงุฒ ุทุฑู ฺฉุงูุงู ุฑุณู ุง ุงูู ุงูุฌุงู ุฎูุงูุฏ ุดุฏ.\n\n"
        
        "**6๏ธโฃ ุชุบุฑ ููุงูู ู ุงุทูุงุนโุฑุณุงู** ๐\n"
        "ุฏุฑ ุตูุฑุช ุชุบุฑ ุฏุฑ ุดุฑุงุท ู ุถูุงุจุทุ ูุณุฎู ุฌุฏุฏ ุงุฒ ุทุฑู ุงูู ุง ฺฉุงูุงู ุฑุณู ุงุทูุงุนโุฑุณุงู ุฎูุงูุฏ ุดุฏ. ูุณุฆููุช ูพฺฏุฑ ุงู ุชุบุฑุงุช ุจุง ฺฉุงุฑุจุฑุงู ุงุณุช.\n\n"
        
        "**7๏ธโฃ ุงุฑุชูุงุก ูุงุจูุชโูุง** ๐\n"
        "ุงุดุชุฑุงฺฉ ุดูุง ุดุงูู ุงูฺฉุงูุงุช ุงุณุช ฺฉู ุฏุฑ ุจุฎุด ูุนุฑู ูพููโูุง ุฏุฑุฌ ุดุฏูโุงูุฏ. ุฏุฑ ุตูุฑุช ุงูุฒูุฏู ูุงุจูุชโูุง ุฌุฏุฏ ุฏุฑ ุขูุฏูุ ุชู ูุงุฑูููู **ุญู ุฏุฑุงูุช ูุฒูู ูุฌุฒุง** ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงู ูฺฺฏโูุง ุฑุง ูุญููุธ ูโุฏุงูุฏ.\n\n"
        
        "**8๏ธโฃ ุญููู ูุญุชูุง ู ูุงูฺฉุช ูุนูู** ๐\n"
        "ฺฉูพโุจุฑุฏุงุฑุ ุฐุฎุฑูโุณุงุฒุ ุจุงุฒูุดุฑ ุง ูุฑูุด ูุญุชูุงุ ุฎุฏูุงุช ุง ุงุทูุงุนุงุช ุงุฑุงุฆูโุดุฏู ุชูุณุท ูุงุฑูููู **ุจุฏูู ูุฌูุฒ ฺฉุชุจ ุฑุณู** ููููุน ุงุณุช. ุฏุฑ ุตูุฑุช ุณูุกุงุณุชูุงุฏูุ ูพฺฏุฑุฏ ูุงููู ู ูุณุฆููุช ฺฉูุฑ ู ูุฏู ูุชูุฌู ูุชุฎูู ุฎูุงูุฏ ุจูุฏ.\n\n"
        
        "โ๏ธ **ุจุง ุงุฏุงูู ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุช ู ุฎุฑุฏ ุงุดุชุฑุงฺฉุ ุดูุง ุชุฃุฏ ูโฺฉูุฏ ฺฉู ุชูุงู ููุงุฑุฏ ููู ุฑุง ูุทุงูุนู ฺฉุฑุฏู ู ุจุง ุขู ููุงูู ูุณุชุฏ.** โ"
    )
    
    keyboard = [
        [InlineKeyboardButton("โช ุจุฎุด ูุจู", callback_data="terms_conditions")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(terms_message_part2, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ููุงุด ููู ุงุดุชุฑุงฺฉ
async def show_subscription_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    message = (
        "**๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ ุฏุณุชุงุฑ ููุด ูุตููุน ูุงุฑูููู** โจ\n\n"
        "ูุทูุงู ฺฉ ุงุฒ ูุญุตููุงุช ุฒุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:\n\n"
        f"๐ **ูุงุฑูููู ุฏฺฉุณ** - {NARMOON_DEX_PRICE}\n"
        "ููุด ูุตููุน ุชุฎุตุต ุจุฑุง ุจุงุฒุงุฑูุง ุบุฑูุชูุฑฺฉุฒ ู ููโฺฉููโูุง\n\n"
        f"๐ **ูุงุฑูููู ฺฉูู** - {NARMOON_COIN_PRICE}\n"
        "ููุด ูุตููุน ุชุฎุตุต ุจุฑุง ุจุงุฒุงุฑูุง ูุชูุฑฺฉุฒ ู ุขูุชฺฉููโูุง\n\n"
        f"๐ **ูพฺฉุฌ ุชุฑฺฉุจ** - {NARMOON_COMBO_PRICE}\n"
        "ุฏุณุชุฑุณ ุจู ุชูุงู ูุงุจูุชโูุง ูุฑ ุฏู ูุญุตูู ุจุง ฺฉ ุงุดุชุฑุงฺฉ ูฺู"
    )
    
    keyboard = [
        [InlineKeyboardButton("๐ ุฎุฑุฏ ูุงุฑูููู ุฏฺฉุณ", callback_data="plan_DEX")],
        [InlineKeyboardButton("๐ ุฎุฑุฏ ูุงุฑูููู ฺฉูู", callback_data="plan_COIN")],
        [InlineKeyboardButton("๐ ุฎุฑุฏ ูพฺฉุฌ ุชุฑฺฉุจ", callback_data="plan_COMBO")],
        [InlineKeyboardButton("๐ ุงุทูุงุนุงุช ุจุดุชุฑ ุฏุฑุจุงุฑู ูุญุตููุงุช", callback_data="product_list")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data="back_to_start")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ุจุงุฒฺฏุดุช ุจู ููู ุงุตู
async def back_to_start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user = query.from_user
    
    # ูุนุฑู ูุญุตูู ุจุง ูุฑูุช ุฌุฏุฏ
    intro_message = (
        f"ุณูุงู {user.first_name}! ๐โจ\n\n"
        f"**ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ูุงุฑูููู** ๐\n\n"
        f"๐ ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ฺฉู ูุนุงููู ฺฏุฑ ุฏุฑ ุจุงุฒุงุฑ ุฑูุฒุงุฑุฒูุง ุฑู ุจุฑุงุช ุณุงุฏูโุชุฑุ ุณุฑุนโุชุฑ ู ููุดููุฏุชุฑ ูโฺฉูู.\n\n"
        f"๐ง ูุงุฑูููู ฺฉ ุณุณุชู ููุด ูุตููุน ุดุฎุตโุณุงุฒโุดุฏู ุจุฑ ูพุงู GPT-4o ูุณุช ฺฉู ุชูุงู ุงุจุฒุงุฑูุง ุญุฑููโุง ุชุญูู ุชฺฉูฺฉุงูุ ุขูฺู ู ุณฺฏูุงูโุฏู ูุญุธูโุง ุฑู ุฏุฑ ุฎูุฏุด ุฌูุน ฺฉุฑุฏูุ ูุฎุตูุตุงู ุจุฑุง ุชุฑุฏุฑูุง ฺฉู ุฏุฑ ูุถุง DEXุ CEXุ ููโฺฉููโูุง ุง ุขูุชฺฉููโูุง ุชุฑูุฏ ูุนุงูุช ูโฺฉูู.\n\n"
        f"๐ ุฏุณุชุงุฑ ููุด ูุตููุน ุชุฑุฏ ูุงุฑูููู ฺฉ ูุดุงูุฑ ูุชุฎุตุต ูุณุชุด ฺฉู ฒด ุณุงุนุช ุฑูุฒ ู ท ุฑูุฒ ููุชู ุฏุฑ ฺฉูุงุฑุชู"
    )
    
    # ููู ุงุตู ุจุฏูู ฺฏุฒูู ูุจุณุงุช
    keyboard = [
        [InlineKeyboardButton("โ ูุงุจูุชโูุง ุฏุณุชุงุฑ ููุด ูุตููุน ูุงุฑูููู", callback_data="product_features")],
        [InlineKeyboardButton("๐ฆ ูุญุตููุงุช ูุงุฑูููู", callback_data="product_list")],
        [InlineKeyboardButton("๐ณ ุฎุฑุฏ ุงุดุชุฑุงฺฉ", callback_data="subscription_menu")],
        [InlineKeyboardButton("โ ุณูุงูุงุช ูุชุฏุงูู", callback_data="faq")],
        [InlineKeyboardButton("๐ ุดุฑุงุท ู ุถูุงุจุท", callback_data="terms_conditions")],
        [InlineKeyboardButton("๐จโ๐ป ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู", url=SUPPORT_LINK)]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(intro_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    return CHOOSING_PLAN

# ุชุงุจุน ุงูุชุฎุงุจ ูพูู ุจุง ุชุบุฑุงุช ููุฑุฏ ูุธุฑ
async def select_plan(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    plan_type = query.data.split("_")[1]
    context.user_data["selected_plan"] = plan_type
    
    # ุงูุชุฎุงุจ ุขุฏุฑุณ ฺฉู ูพูู ุจู ุตูุฑุช ุชุตุงุฏู
    wallet_address = get_random_wallet_address()
    
    # ูุดุฎุต ฺฉุฑุฏู ูุงู ู ููุช ูพูู
    if plan_type == "DEX":
        plan_name = "ูุงุฑูููู ุฏฺฉุณ"
        plan_price = "ต ุฏูุงุฑ ูุงูุงูู (ุจุง ุชุฎูู ตฐูช)"
    elif plan_type == "COIN":
        plan_name = "ูุงุฑูููู ฺฉูู"
        plan_price = "ต ุฏูุงุฑ ูุงูุงูู (ุจุง ุชุฎูู ตฐูช)"
    else:  # COMBO
        plan_name = "ูพฺฉุฌ ุชุฑฺฉุจ ูุงุฑูููู ุฏฺฉุณ + ูุงุฑูููู ฺฉูู"
        plan_price = "ฑฐ ุฏูุงุฑ ูุงูุงูู (ุจุง ุชุฎูู ูฺู)"
    
    # ุงุฑุณุงู ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช ุจุง ูุงุจูุช ฺฉูฺฉ ุฑู ููฺฉ ู ุฏฺฉููโูุง ุงุถุงู
    payment_message = (
        f"๐ณ **ูพุฑุฏุงุฎุช ุจุฑุง {plan_name}** โจ\n\n"
        f"ููุช: **{plan_price}** ๐ฐ\n\n"
        f"โ๏ธ **ุชูุฌู ููู**: ูุทูุงู ูุจูุบ {plan_price.split()[0]} ุชุชุฑ (USDT) ุฑุง **ููุท** ุจู ุขุฏุฑุณ ุฒุฑ ุฏุฑ ุดุจฺฉู **{TETHER_NETWORK}** ุงุฑุณุงู ฺฉูุฏ. ุงุฑุณุงู ุจู ูุฑ ุขุฏุฑุณ ุฏฺฏุฑ ุง ุฏุฑ ุดุจฺฉูโุง ุบุฑ ุงุฒ ุณููุงูุง ููุฌุฑ ุจู ุงุฒ ุฏุณุช ุฑูุชู ูุฌู ุดูุง ุฎูุงูุฏ ุดุฏ ู ูุณุฆููุช ุขู ุจู ุนูุฏู ุดูุง ุงุณุช! ๐\n\n"
        f"`{wallet_address}`\n\n"
        f"ูพุณ ุงุฒ ูพุฑุฏุงุฎุชุ ูุทูุงู TXID (ุดูุงุณู ุชุฑุงฺฉูุด) ุฑุง ุจู ูพุดุชุจุงู ุงุฑุณุงู ฺฉูุฏ. ๐ฉ\n"
        f"*ูพุณ ุงุฒ ุชุฃุฏ ูพุฑุฏุงุฎุชุ ููฺฉ ุฏุณุชุฑุณ ุจู ุฏุณุชุงุฑ ูุนุงููู ฺฏุฑ ููุด ูุตููุน ูุงุฑูููู ุจุฑุง ุดูุง ุงุฑุณุงู ุฎูุงูุฏ ุดุฏ.* โ"
    )
    
    keyboard = [
        [InlineKeyboardButton("๐จโ๐ป ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู", url=SUPPORT_LINK)],
        [InlineKeyboardButton("๐ ุดุฑุงุท ู ุถูุงุจุท", callback_data="terms_conditions")],
        [InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ุงูุชุฎุงุจ ูพูู", callback_data="subscription_menu")],
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    # ุงุฑุณุงู ูพุงู
    await query.edit_message_text(payment_message, reply_markup=reply_markup, parse_mode="Markdown")
    
    # ุซุจุช ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช ุฏุฑ ูุงฺฏ
    user_id = query.from_user.id
    username = query.from_user.username
    first_name = query.from_user.first_name
    timestamp = datetime.now(pytz.timezone('Asia/Tehran')).strftime("%Y-%m-%d %H:%M:%S")
    
    logger.info(f"New payment request - User: {username} ({user_id}), Plan: {plan_type}, Time: {timestamp}, Wallet: {wallet_address}")
    
    return CHOOSING_PLAN

# ุชุงุจุน ูุฏุฑุช ุฎุทุงูุง
async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    logger.error(f"Error occurred: {context.error}")

# ุชุงุจุน ุฑุงูููุง
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_text = (
        "๐ฐ **ุฑุงูููุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุช ูุงุฑูููู** ๐\n\n"
        "ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ุฑุจุงุชุ ุดูุง ูโุชูุงูุฏ ุจู ุฏุณุชุงุฑ ููุด ูุตููุน ูุงุฑูููู ุจุฑุง ุชุญูู ุจุงุฒุงุฑ ุฑูุฒุงุฑุฒูุง ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ. ๐\n\n"
        "ุฏุณุชูุฑุงุช ูุงุจู ุงุณุชูุงุฏู:\n"
        "โข /start - ุดุฑูุน ูุฌุฏุฏ ุฑุจุงุช ู ููุงุด ููู ุงุตู ๐\n"
        "โข /help - ููุงุด ุงู ุฑุงูููุง โน๏ธ\n"
        "โข /about - ุงุทูุงุนุงุช ุฏุฑุจุงุฑู ูุงุฑูููู ๐\n\n"
        "ุจุฑุง ุฎุฑุฏ ุงุดุชุฑุงฺฉุ ุงุฒ ฺฏุฒูู **ุฎุฑุฏ ุงุดุชุฑุงฺฉ** ุฏุฑ ููู ุงุตู ุงุณุชูุงุฏู ฺฉูุฏ ู ฺฉ ุงุฒ ูุญุตููุงุช ููุฌูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ. ๐ณ\n"
        "ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ูพุดุชุจุงูุ ูโุชูุงูุฏ ุงุฒ ฺฏุฒูู ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู ุงุณุชูุงุฏู ฺฉูุฏ. ๐จโ๐ป"
    )
    await update.message.reply_text(help_text, parse_mode="Markdown")

# ุชุงุจุน ุฏุฑุจุงุฑู ูุง
async def about_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    about_text = (
        "๐ฎ **ุฏุฑุจุงุฑู ูุงุฑูููู** โจ\n\n"
        "**ูุงุฑูููู | ุฏุณุชุงุฑ ููุด ูุตููุน ูุนุงููุงุช ุฏุฑ ุจุงุฒุงุฑ ุฑูุฒุงุฑุฒูุง** ๐\n\n"
        "ูุงุฑูููู ฺฉ ุฏุณุชุงุฑ ุชูุงูโุนุงุฑ ูุจุชู ุจุฑ ููุด ูุตููุน GPT-4o ุจุฑุง ุชุฑุฏุฑูุง ุญุฑููโุง ู ุณุฑูุงูโฺฏุฐุงุฑุงู ุฏุฑ ุฏูุง ุฑูุฒุงุฑุฒูุงุณุช. ๐ง๐น\n\n"
        "ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงุฑููููุ ุดูุง ูโุชูุงูุฏ ุจู ุงุทูุงุนุงุช ุฒุฑ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ:\n"
        "โข ุชุญูู ฺฉูุงู ุงูุชุตุงุฏ ู ุชุฑฺฉุจ ุขู ุจุง ุจุชฺฉูู ๐\n"
        "โข ูุนุฑู ุชุฑูุฏูุง ุฑูุฒ ฺฉููโูุง ู ุชูฺฉูโูุง ๐\n"
        "โข ูุฏุฑุช ูพูุฑุชูู ู ุฑุณฺฉ ๐ก๏ธ\n"
        "โข ุณฺฏูุงูโูุง ูุนุงููุงุช ุฏูู ๐ฏ\n"
        "โข ุชุญูู ุฑูุชุงุฑ ูููฺฏโูุง ู ฺฉู ูพููโูุง ๐\n"
        "โข ู ุจุณุงุฑ ููุงุฑุฏ ุฏฺฏุฑ... ๐\n\n"
        "ุจุฑุง ุงุทูุงุนุงุช ุจุดุชุฑ ู ุฏุฑุงูุช ูพุดุชุจุงูุ ุงุฒ ฺฏุฒูู ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู ุงุณุชูุงุฏู ฺฉูุฏ. ๐จโ๐ป"
    )
    await update.message.reply_text(about_text, parse_mode="Markdown")

def main():
    # ุฏุฑุงูุช ุชูฺฉู ุฑุจุงุช
    token = os.environ.get("TELEGRAM_BOT_TOKEN", "8155620675:AAEkObqE_6cRG2mrFG09hELW77cCAeR5rJc")

    # ุงุฌุงุฏ ุงูพูฺฉุดู
    application = Application.builder().token(token).build()

    # ุชุนุฑู ฺฏูุชฺฏู ุงุตู
    conv_handler = ConversationHandler(
        entry_points=[CommandHandler("start", start)],
        states={
            CHOOSING_PLAN: [
                CallbackQueryHandler(show_product_features, pattern="^product_features$"),
                CallbackQueryHandler(show_product_list, pattern="^product_list$"),
                CallbackQueryHandler(show_faq, pattern="^faq$"),
                CallbackQueryHandler(show_faq_part2, pattern="^faq_part2$"),
                CallbackQueryHandler(show_terms_conditions, pattern="^terms_conditions$"),
                CallbackQueryHandler(show_terms_part2, pattern="^terms_part2$"),
                CallbackQueryHandler(back_to_start, pattern="^back_to_start$"),
                CallbackQueryHandler(select_plan, pattern="^plan_"),
                CallbackQueryHandler(show_subscription_menu, pattern="^subscription_menu$"),
            ],
        },
        fallbacks=[CommandHandler("start", start)],
    )

    # ุงุถุงูู ฺฉุฑุฏู ููุฏูุฑูุง
    application.add_handler(conv_handler)
    
    # ููุฏูุฑ ุฑุงูููุง
    application.add_handler(CommandHandler("help", help_command))
    
    # ููุฏูุฑ ุฏุฑุจุงุฑู ูุง
    application.add_handler(CommandHandler("about", about_command))
    
    # ุงุถุงูู ฺฉุฑุฏู ููุฏูุฑ ุฎุทุง
    application.add_error_handler(error_handler)

    logger.info("ุฑุจุงุช ูุงุฑูููู ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช...")
    # ุดุฑูุน ุฑุจุงุช
    application.run_polling()

if __name__ == "__main__":
    main()
